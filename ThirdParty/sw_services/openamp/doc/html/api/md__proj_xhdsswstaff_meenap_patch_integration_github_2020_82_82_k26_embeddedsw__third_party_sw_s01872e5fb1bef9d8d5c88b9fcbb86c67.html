<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.5"/>
<title>openamp: open-amp</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="HTML_custom.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="xlogo_bg.gif"/></td>
  <td style="padding-left: 0.5em;">
   <div id="projectname">openamp
   </div>
   <div id="projectbrief">Xilinx Vitis Drivers API Documentation</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.5 -->
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Overview</span></a></li>
      <li><a href="annotated.html"><span>Data&#160;Structures</span></a></li>
      <li class="current"><a href="pages.html"><span>Examples</span></a></li>
    </ul>
  </div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('md__proj_xhdsswstaff_meenap_patch_integration_github_2020_82_82_k26_embeddedsw__third_party_sw_s01872e5fb1bef9d8d5c88b9fcbb86c67.html','');});
</script>
<div id="doc-content">
<div class="header">
  <div class="headertitle">
<div class="title">open-amp </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>This repository is the home for the Open Asymmetric Multi Processing (OpenAMP) framework project. The OpenAMP framework provides software components that enable development of software applications for Asymmetric Multiprocessing (AMP) systems. The framework provides the following key capabilities.</p>
<ol type="1">
<li>Provides Life Cycle Management, and Inter Processor Communication capabilities for management of remote compute resources and their associated software contexts.</li>
<li>Provides a stand alone library usable with RTOS and Baremetal software environments</li>
<li>Compatibility with upstream Linux remoteproc and rpmsg components</li>
<li>Following AMP configurations supported a. Linux master/Generic(Baremetal) remote b. Generic(Baremetal) master/Linux remote</li>
<li>Proxy infrastructure and supplied demos showcase ability of proxy on master to handle printf, scanf, open, close, read, write calls from Bare metal based remote contexts.</li>
</ol>
<h2>OpenAMP Source Structure</h2>
<p>``` |- lib/ | |- common/ # common helper functions | |- virtio/ # virtio implementation | |- rpmsg/ # rpmsg implementation | |- remoteproc/ # remoteproc implementation | | |- drivers # remoteproc drivers | |- proxy/ # implement one processor access device on the | | # other processor with file operations |- apps/ # demonstration/testing applications | |- machine/ # common files for machine can be shared by applications | # It is up to each app to decide whether to use these files. | |- system/ # common files for system can be shared by applications | # It is up to each app to decide whether to use these files. |- obsolete # It is used to build libs which may also required when | # building the apps. It will be removed in future since | # user can specify which libs to use when compiling the apps. |- cmake # CMake files ```</p>
<p>OpenAMP library libopen_amp is composed of the following directories in <code>lib/</code>:</p>
<ul>
<li><code>common/</code></li>
<li><code>virtio/</code></li>
<li><code>rpmsg/</code></li>
<li><code>remoteproc/</code></li>
<li><code>proxy/</code></li>
</ul>
<p>OpenAMP system/machine support has been moved to libmetal, the system/machine layer in the <code>apps/</code> directory is for system application initialization, and resource table definition.</p>
<h3>libmetal APIs used in OpenAMP</h3>
<p>Here are the libmetal APIs used by OpenAMP, if you want to port OpenAMP for your system, you will need to implement the following libmetal APIs in the libmetal's <code>lib/system/&lt;SYS&gt;</code> directory:</p>
<ul>
<li>alloc, for memory allocation and memory free</li>
<li>cache, for flushing cache and invalidating cache</li>
<li>io, for memory mapping. OpenAMP required memory mapping in order to access vrings and carved out memory.</li>
<li>irq, for IRQ handler registration, IRQ disable/enable and global IRQ handling.</li>
<li>mutex</li>
<li>shmem (For RTOS, you can usually use the implementation from <code>lib/system/generic/</code>)</li>
<li>sleep, at the moment, OpenAMP only requires microseconds sleep as when OpenAMP fails to get a buffer to send messages, it will call this function to sleep and then try again.</li>
<li>time, for timestamp</li>
<li>init, for libmetal initialization.</li>
<li>atomic</li>
</ul>
<p>Please refer to <code>lib/system/generic</code> when you port libmetal for your system.</p>
<p>If you a different compiler to GNU gcc, please refer to <code>lib/compiler/gcc/</code> to port libmetal for your compiler. At the moment, OpenAMP needs the atomic operations defined in <code>lib/compiler/gcc/atomic.h</code>.</p>
<h2>OpenAMP Compilation</h2>
<p>OpenAMP uses CMake for library and demonstration application compilation. OpenAMP requires libmetal library. For now, you will need to download and compile libmetal library separately before you compiling OpenAMP library. In future, we will try to make libmetal as a submodule to OpenAMP to make this flow easier.</p>
<h3>Example to compile OpenAMP for Zephyr</h3>
<p>You can compile OpenAMP library for Zephyr. As OpenAMP uses libmetal, please refer to libmetal README to build libmetal for Zephyr before building OpenAMP library for Zephyr. As Zephyr uses CMake, we build OpenAMP library as a target of Zephyr CMake project. Here is how to build libmetal for Zephyr: ``` $ export ZEPHRY_GCC_VARIANT=zephyr $ export ZEPHRY_SDK_INSTALL_DIR=&lt;where zephyr="" sdk="" is="" installed&gt;=""&gt; $ source &lt;git_clone_zephyr_project_source_root&gt;/zephyr-env.sh</p>
<p>$ cmake &lt;OpenAMP_source_root&gt; \ -DWITH_ZEPHYR=on -DBOARD=qemu_cortex_m3 \ -DCMAKE_INCLUDE_PATH="&lt;libmetal_zephyr_build_dir&gt;/lib/include" \ -DCMAKE_LIBRARY_PATH="&lt;libmetal_zephyr_build_dir&gt;/lib" \ $ make VERBOSE=1 all ```</p>
<h3>Example to compile OpenAMP for communication between Linux processes:</h3>
<ul>
<li>Install libsysfs devel and libhugetlbfs devel packages on your Linux host.</li>
<li><p class="startli">build libmetal library on your host as follows:</p>
<p class="startli">``` $ mkdir -p build-libmetal $ cd build-libmetal $ cmake &lt;libmetal_source&gt; $ make VERBOSE=1 DESTDIR=&lt;libmetal_install&gt; install ```</p>
</li>
<li>build OpenAMP library on your host as follows: <pre class="fragment">  $ mkdir -p build-openamp
  $ cd build-openamp
  $ cmake &lt;openamp_source&gt; -DCMAKE_INCLUDE_PATH=&lt;libmetal_built_include_dir&gt; \
        -DCMAKE_LIBRARY_PATH=&lt;libmetal_built_lib_dir&gt; [-DWITH_APPS=ON]
  $ make VERBOSE=1 DESTDIR=$(pwd) install
</pre></li>
</ul>
<p>The OpenAMP library will be generated to <code>build/usr/local/lib</code> directory, headers will be generated to <code>build/usr/local/include</code> directory, and the applications executable will be generated to <code>build/usr/local/bin</code> directory.</p>
<ul>
<li>cmake option <code>-DWITH_APPS=ON</code> is to build the demonstration applications.</li>
<li><p class="startli">If you have used <code>-DWITH_APPS=ON</code> to build the demos, you can try them on your Linux host as follows:</p>
<p class="startli">``` </p>
<h1>Start echo test server to wait for message to echo</h1>
<p class="startli">$ sudo LD_LIBRARY_PATH=&lt;openamp_built&gt;/usr/local/lib:&lt;libmetal_built&gt;/usr/local/lib \ build/usr/local/bin/rpmsg-echo-shared </p>
<h1>Run echo test to send message to echo test server</h1>
<p class="startli">$ sudo LD_LIBRARY_PATH=&lt;openamp_built&gt;/usr/local/lib:&lt;libmetal_built&gt;/usr/local/lib \ build/usr/local/bin/rpmsg-echo-ping-shared 1 ```</p>
</li>
</ul>
<h3>Example to compile Zynq UltraScale+ MPSoC R5 generic(baremetal) remote:</h3>
<ul>
<li>build libmetal library on your host as follows:<ul>
<li><p class="startli">Create your on cmake toolchain file to compile libmetal for your generic (baremetal) platform. Here is the example of the toolchain file:</p>
<p class="startli">``` set (CMAKE_SYSTEM_PROCESSOR "arm" CACHE STRING "") set (MACHINE "zynqmp_r5" CACHE STRING "")</p>
<p class="startli">set (CROSS_PREFIX "armr5-none-eabi-" CACHE STRING "") set (CMAKE_C_FLAGS "-mfloat-abi=soft -mcpu=cortex-r5 -Wall -Werror -Wextra \
           -flto -Os -I/ws/xsdk/r5_0_bsp/psu_cortexr5_0/include" CACHE STRING "")</p>
<p class="startli">SET(CMAKE_EXE_LINKER_FLAGS "${CMAKE_EXE_LINKER_FLAGS} -flto") SET(CMAKE_AR "gcc-ar" CACHE STRING "") SET(CMAKE_C_ARCHIVE_CREATE "&lt;CMAKE_AR&gt; qcs &lt;TARGET&gt; &lt;LINK_FLAGS&gt; &lt;OBJECTS&gt;") SET(CMAKE_C_ARCHIVE_FINISH   true)</p>
<p class="startli">include (cross-generic-gcc) ```</p>
</li>
<li><p class="startli">Compile libmetal library:</p>
<p class="startli">``` $ mkdir -p build-libmetal $ cd build-libmetal $ cmake &lt;libmetal_source&gt; -DCMAKE_TOOLCHAIN_FILE=&lt;toolchain_file&gt; $ make VERBOSE=1 DESTDIR=&lt;libmetal_install&gt; install ```</p>
</li>
</ul>
</li>
<li>build OpenAMP library on your host as follows:<ul>
<li><p class="startli">Create your on cmake toolchain file to compile openamp for your generic (baremetal) platform. Here is the example of the toolchain file: ``` set (CMAKE_SYSTEM_PROCESSOR "arm" CACHE STRING "") set (MACHINE "zynqmp_r5" CACHE STRING "") set (CROSS_PREFIX "armr5-none-eabi-" CACHE STRING "") set (CMAKE_C_FLAGS "-mfloat-abi=soft -mcpu=cortex-r5 -Os -flto \ -I/ws/libmetal-r5-generic/usr/local/include \ -I/ws/xsdk/r5_0_bsp/psu_cortexr5_0/include" CACHE STRING "")
        set (CMAKE_ASM_FLAGS        "-mfloat-abi=soft -mcpu=cortex-r5" CACHE STRING "")
        set (PLATFORM_LIB_DEPS      "-lxil -lc -lm" CACHE STRING "")
        SET(CMAKE_EXE_LINKER_FLAGS "${CMAKE_EXE_LINKER_FLAGS} -flto")
        SET(CMAKE_AR  "gcc-ar" CACHE STRING "")
        SET(CMAKE_C_ARCHIVE_CREATE "&lt;CMAKE_AR&gt; qcs &lt;TARGET&gt; &lt;LINK_FLAGS&gt; &lt;OBJECTS&gt;") SET(CMAKE_C_ARCHIVE_FINISH   true) set (CMAKE_FIND_ROOT_PATH /ws/libmetal-r5-generic/usr/local/lib \ /ws/xsdk/r5_bsp/psu_cortexr5_0/lib )</p>
<p class="startli">include (cross_generic_gcc) ```</p>
</li>
<li>We use cmake <code>find_path</code> and <code>find_library</code> to check if libmetal includes and libmetal library is in the includes and library search paths. However, for non-linux system, it doesn't work with <code>CMAKE_INCLUDE_PATH</code> and <code>CMAKE_LIBRARY_PATH</code> variables, and thus, we need to specify those paths in the toolchain file with <code>CMAKE_C_FLAGS</code> and <code>CMAKE_FIND_ROOT_PATH</code>.</li>
</ul>
</li>
<li><p class="startli">Compile the OpenAMP library:</p>
<p class="startli">``` $ mkdir -p build-openamp $ cd build-openamp $ cmake &lt;openamp_source&gt; -DCMAKE_TOOLCHAIN_FILE=&lt;toolchain_file&gt; $ make VERBOSE=1 DESTDIR= install ```</p>
</li>
</ul>
<p>The OpenAMP library will be generated to <code>build/usr/local/lib</code> directory, headers will be generated to <code>build/usr/local/include</code> directory, and the applications executable will be generated to <code>build/usr/local/bin</code> directory.</p>
<h3>Example to compile OpenAMP Linux Userspace for Zynq UltraScale+ MPSoC</h3>
<p>We can use yocto to build the OpenAMP Linux userspace library and application. open-amp and libmetal recipes are in this yocto layer: <a href="https://github.com/OpenAMP/meta-openamp">https://github.com/OpenAMP/meta-openamp</a></p>
<ul>
<li>Add the <code>meta-openamp</code> layer to your layers in your yocto build project's <code>bblayers.conf</code> file.</li>
<li>Add <code>libmetal</code> and <code>open-amp</code> to your packages list. E.g. add <code>libmetal</code> and <code>open-amp</code> to the <code>IMAGE_INSTALL_append</code> in the <code>local.conf</code> file.</li>
<li>You can also add OpenAMP demos Linux applications packages to your yocto packages list. OpenAMP demo examples recipes are also in <code>meta-openamp</code>: <a href="https://github.com/OpenAMP/meta-openamp/tree/master/recipes-openamp/openamp-examples">https://github.com/OpenAMP/meta-openamp/tree/master/recipes-openamp/openamp-examples</a></li>
</ul>
<p>In order to user OpenAMP(RPMsg) in Linux userspace, you will need to have put the IPI device, vring memory and shared buffer memory to your Linux kernel device tree. The device tree example can be found here: <a href="https://github.com/OpenAMP/open-amp/blob/master/apps/machine/zynqmp/openamp-linux-userspace.dtsi">https://github.com/OpenAMP/open-amp/blob/master/apps/machine/zynqmp/openamp-linux-userspace.dtsi</a></p>
<h2>Supported System and Machines</h2>
<p>For now, it supports:</p>
<ul>
<li>Zynq generic slave</li>
<li>Zynq UltraScale+ MPSoC R5 generic slave</li>
<li>Linux host OpenAMP between Linux userspace processes</li>
<li>Linux userspace OpenAMP RPMsg master</li>
<li>Linux userspace OpenAMP RPMsg slave</li>
</ul>
<h2>Known Limitations:</h2>
<ol type="1">
<li>OpenAMP framework supports OpenAMP firmware running as master, however, the example to show this ability is not ready yet.</li>
<li>In case of OpenAMP on Linux userspace for inter processors communication, life cycle management with remoteproc is not supported yet, that is for now, it is not able to load the remote firmware with OpenAMP running on Linux userspace.</li>
<li>In case of OpenAMP on Linux userspace for inter processors communication, it only supports static vrings and shared buffers.</li>
<li><code>sudo</code> is required to run the OpenAMP demos between Linux processes, as it doesn't work on some systems if you are normal users.</li>
</ol>
<p>For using the framework please refer to the wiki of the OpenAMP repo. Subscribe to the open-amp mailing list at <a href="https://groups.google.com/group/open-amp">https://groups.google.com/group/open-amp</a>. </p>
</div></div><!-- contents -->
</div><!-- doc-content -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Copyright &copy; 2015 Xilinx Inc. All rights reserved.</li>
  </ul>
</div>
</body>
</html>
